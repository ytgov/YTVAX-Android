package ca.bc.gov.shcdecoder

import androidx.test.ext.junit.runners.AndroidJUnit4
import androidx.test.platform.app.InstrumentationRegistry
import ca.bc.gov.shcdecoder.model.ImmunizationStatus
import kotlinx.coroutines.runBlocking
import org.junit.Assert.assertEquals
import org.junit.Before
import org.junit.Test
import org.junit.runner.RunWith

@RunWith(AndroidJUnit4::class)
class BcCardVerifierTest {

    private lateinit var bcCardVerifier: BcCardVerifier

    @Before
    fun setUp() {
        val context = InstrumentationRegistry.getInstrumentation().targetContext
        bcCardVerifier = BcCardVerifier(context)
    }

    @Test
    fun shouldBeFullyImmunizedOnTwoDoseVaccine() = runBlocking{
        val shcUri =
            "shc:/56762909524320603460292437404460312229595326546034602925" +
                    "4077280433602870286471674522280928613331456437653141590" +
                    "6402203064504590856435503414245413640370636654171372412" +
                    "3638030437562204673740753232392543344332605736011041301" +
                    "0537174742435744144043462034473657503626862762120623252" +
                    "2027525474696822660444620835583838407208600933007704290" +
                    "3233410235567280558597239325426524223052252236467055543" +
                    "0856637141254038405873445452005920264300550828765200251" +
                    "276044277374508122306350906530040766670442424295827042007392358252357507625087741066662527336450827690675034352417436090642540427660311595435036766065854293470644041532128362363700336432904327744504028376668567263720335656603073325046437325530317275122603766832262467613776577455692435670735622520562441446940616210662065565861303611307343333036281111727222202800312507387330361075224238077568322804043037276577637565352709427469297738757542716700240752053274406967244050213235404455414545624263006368235734547334602473560662765033095908347521556059367533453906353322576120740060433573385832262254073238256220445005655208377159426472053877211211362704093639380943680377091045086923100670700625712254217039215941453636665077331170456853233367346771102445073676707238255738415204455474537459590452280338066444042606405900414176747104606269440421036543405206423037600521557133043035765856755020087372777311424250351073610010345365667055715375086956614150093057254105632157732766726457081211011029654236102129372638037029095964532156046953052122612138350557110032070574007433720857327255610862436953543134763052095629527703325808037272596174435333754435397540115836"

        val result = bcCardVerifier.verify(shcUri)

        assertEquals(ImmunizationStatus.FULLY_IMMUNIZED, result.status)
    }

    @Test
    fun shouldBePartiallyImmunizationOnSingleDoseOfTwoDoseVaccine() = runBlocking {
        val shcUri =
            "shc:/567629095243206034602924374044603122295953265460346029254077280433602870286471674522280928613331456437653141590640220306450459085643550341424541364037063665417137241236380304375622046737407532323925433443326057360157413131537170742435764144277366374050654441652771605936122128585243662857302142300770042774292968434423504372437063346237376721637641655961341000743864095220725376077368056777414274386233082323430328580950777332252927252207556254640975770850685504560800592659712844243066657620542107310911365029520025223903302535667154500008406731255804731275407273377625116038267356213030554525717244297020346469292122654006556111282077374071553112032334370803526969286030046273656507443952706644616033273706385042285777595729343609584144694139621007204357626130741130734333303644111100722220545025301130062728570823232922030363245230634423100730070740395731563924086544754171677525075205320754696724545029322840525754412541524330566933547577116868391164036543500872100620057158201054643660090542723436245737216112035811123020664029775829372665666605054345122205037276424535106620006577217327665669433469337363705742086305053403072425542627226868585837736443084406410426533855235306262507366872726831356069046441752050344227416924033806644409357267390767691168034230556325443438090977390821523120663304034344695052212427323565723365570705525073065836590772104372225672107555506565002336016608634243773033372510101132583669050010557774422406245275126959712120426904112344293453440841753034700342555544753461742173520426755756231237703464262020411024566974201136"

        val result = bcCardVerifier.verify(shcUri)

        assertEquals(ImmunizationStatus.PARTIALLY_IMMUNIZED, result.status)
    }

    @Test
    fun shouldBePartiallyImmunizedOnDaysNotPassedSinceVaccinated()  = runBlocking{

        val shcUri =
            "shc:/567629095243206034602924374044603122295953265460346029254077280433602870286471674522280928613331456437653141590640220306450459085643550341424541364037063665417137241236380304375622046737407532323925433443326057360157413131537170742435764144277366374050654441652771605936122128585243662857302142300770042774292968434423504372437063346237376721637641655961341000743864095220725376077368056777414274386233082323430328580950777332252927252207556254640975770850685504560800592659712844243066657620542107310911365029520025223903302535667154500008406731255804731275407273377625116038267356213030554525717244297020346469292122654006556111282077374071553112032334370803526969286030046273656507443952706644616033273706385042285777595729343609584144694139621007204357626130741130734333303644111100722220545025301130062728570823232922030363245230634423100730070740395731563924086544754171677525075205320754696724545029322840525754412541524330566933547577116868391164036543500872100620057158201054643660090542723436245737216112035811123020664029775829372665666605054345122205037276424535106620006577217327665669433469337363705742086305053403072425542627226868585837736443084406410426533855235306262507366872726831356069046441752050344227416924033806644409357267390767691168034230556325443438090977390821523120663304034344695052212427323565723365570705525073065836590772104372225672107555506565002336015032441143053610202654423144004353423728380722653721584461060534262010300609283708695252280640762873375704117434316042645352547327240824206239360309261025092125367705355558"

        val result = bcCardVerifier.verify(shcUri)

        assertEquals(ImmunizationStatus.PARTIALLY_IMMUNIZED, result.status)
    }


    @Test
    fun shouldValidateYukonQR() = runBlocking{
        val shcUri = "shc:/567629095243206034602924374044603122295953265460346029254077280433602870286471674522280928645973372408413923414540772126330432073264712652050864562329744562253639241270414233714562296632634103406321415426116057360110413531537133202535054344567344275854106065560361403725380326623820596332376357297435777034455924522911203350256106272739682541031029637454533877297510106165064334002954281040453471120800667009066856346922120729237274635661401107762311086560207158384031037260400469525339706877305267693445773659353857046573595521093900502973333042531225676103420038756143707527605375582537350707373836447373772072616574417603077226777062682855752220126631296100241237575835626768711129002134706039030456676563306238505665584355382858442211072476052408762257275900376659062061295330333869222106522527452008380663682958317309346257200656242411397203585041755962772138323040623259274371117025045707705924120923612312105450570874717773276800733133586874340927207103350325110826327772572559332929436727232839626759770773085031596131726172582744585840556800095334763724584254370744202730507407225355772771381231436640400752594420717264682775687672522572387436703056543807036520117300075836567334442540640654674452721163605567623939545310530611076006740524596834765853755441213166545343206055413959224024266511050923427232740464564408675332680558575326687360313945650621705321394322554531255923102506742565613962077706757474056866396630277232763009552160435320744128675926417075657310683758047256604523252775125407267165586805002150705805226938412656223144684550127070307307003640016838057441334052354361336058104004696828665561086538285643682822395436270459766069612330413630540431550023723237096209670465075338310536770545001243660410390607335563095758"
        val result = bcCardVerifier.verify(shcUri)
        assertEquals(ImmunizationStatus.FULLY_IMMUNIZED, result.status)
    }

}